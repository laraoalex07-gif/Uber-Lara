<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#10b981">
    <title>LaraApp7 - Multi Servicios LARA</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="m-0 p-0">
    <div id="app"></div>
    <script>
        let App = {
            vista: 'login',
            darkMode: false,
            config: {
                nombre: 'LaraApp7\nMULTI SERVICIOS LARA',
                eslogan: 'Servicio de transporte privado',
                detalle: 'Moviendo vidas',
                logo: null
            },
            registros: [],
            viajes: [],
            clientes: [],
            deudas: [],
            diezmos: [],
            infoFinanciera: [],
            notas: [],
            categorias: ['Uber diario','Uber semanal','Gasolina','Internet','Privado','Mantenimiento carro','Renta CARRO','Otros']
        };

        const cargar = () => {
            const data = localStorage.getItem('LaraApp7Data');
            if (data) App = {...App, ...JSON.parse(data)};
        };

        const guardar = () => {
            localStorage.setItem('LaraApp7Data', JSON.stringify(App));
        };

        const getQuincena = () => {
            const hoy = new Date();
            const dia = hoy.getDate();
            const mes = hoy.getMonth();
            const a√±o = hoy.getFullYear();
            const meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            
            if (dia <= 15) {
                return {
                    inicio: new Date(a√±o, mes, 1),
                    fin: new Date(a√±o, mes, 15, 23, 59, 59),
                    texto: `1-15 de ${meses[mes]}`
                };
            } else {
                const ultimoDia = new Date(a√±o, mes + 1, 0).getDate();
                return {
                    inicio: new Date(a√±o, mes, 16),
                    fin: new Date(a√±o, mes, ultimoDia, 23, 59, 59),
                    texto: `16-${ultimoDia} de ${meses[mes]}`
                };
            }
        };

        const calcBalance = () => {
            const q = getQuincena();
            const regs = App.registros.filter(r => {
                const f = new Date(r.fecha);
                return f >= q.inicio && f <= q.fin;
            });
            
            const ingresos = regs.filter(r => r.tipo === 'Ingreso').reduce((s, r) => s + parseFloat(r.monto || 0), 0);
            const gastos = regs.filter(r => r.tipo === 'Gasto').reduce((s, r) => s + parseFloat(r.monto || 0), 0);
            
            return {
                ingresos,
                gastos,
                ganancia: ingresos - gastos,
                quincena: q.texto
            };
        };

        const ir = (v) => {
            App.vista = v;
            render();
        };
const render = () => {
            const a = document.getElementById('app');
            const d = App.darkMode;

            if (App.vista === 'login') {
                a.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4 ${d?'bg-gray-900':'bg-gradient-to-br from-emerald-50 to-blue-50'}">
                        <div class="${d?'bg-gray-800':'bg-white'} w-full max-w-md rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-8">
                                ${App.config.logo ? `<img src="${App.config.logo}" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover shadow-lg">` :
                                `<div class="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-emerald-500 to-blue-600 rounded-full flex items-center justify-center shadow-lg">
                                    <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                </div>`}
                                <h1 class="text-2xl font-bold mb-2 whitespace-pre-line ${d?'text-white':'text-gray-800'}">${App.config.nombre}</h1>
                                <p class="text-lg ${d?'text-emerald-400':'text-emerald-600'} font-semibold mb-1">${App.config.eslogan}</p>
                                <p class="${d?'text-gray-400':'text-gray-600'}">${App.config.detalle}</p>
                            </div>
                            <button onclick="ir('dashboard')" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition">üöÄ Entrar</button>
                        </div>
                    </div>
                `;
            } else if (App.vista === 'dashboard') {
                const bal = calcBalance();
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6 rounded-b-3xl shadow-lg">
                            <h1 class="text-2xl font-bold mb-4">üìä Dashboard</h1>
                            <div class="${d?'bg-gray-800':'bg-white/20'} backdrop-blur-sm rounded-xl p-4">
                                <p class="text-sm opacity-90 mb-2">Quincena: ${bal.quincena}</p>
                                <div class="grid grid-cols-3 gap-3">
                                    <div><p class="text-xs opacity-80">Ingresos</p><p class="text-lg font-bold">Q${bal.ingresos.toFixed(2)}</p></div>
                                    <div><p class="text-xs opacity-80">Gastos</p><p class="text-lg font-bold">Q${bal.gastos.toFixed(2)}</p></div>
                                    <div><p class="text-xs opacity-80">Ganancia</p><p class="text-lg font-bold">Q${bal.ganancia.toFixed(2)}</p></div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 grid grid-cols-2 gap-4 mt-4">
                            ${[['diezmos','üí∞','Diezmos'],['notas','üìù','Notas'],['infoFinanciera','üè¶','Info Financiera'],['ajustes','‚öôÔ∏è','Ajustes']].map(([v,i,l])=>`
                                <button onclick="ir('${v}')" class="${d?'bg-gray-800':'bg-white'} p-6 rounded-xl shadow-lg hover:shadow-xl transition">
                                    <div class="text-4xl mb-2">${i}</div>
                                    <p class="font-semibold ${d?'text-white':'text-gray-800'}">${l}</p>
                                </button>
                            `).join('')}
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'registros') {
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">üìñ Libro Diario</h1>
                        </div>
                        <div class="p-4">
                            <button onclick="abrirFormReg()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                                <span class="text-xl">‚ûï</span> A√±adir Registro
                            </button>
                            <div class="space-y-3">
                                ${App.registros.sort((a,b)=>new Date(b.fecha)-new Date(a.fecha)).map((r,i)=>`
                                    <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <p class="font-semibold ${r.tipo==='Ingreso'?'text-emerald-600':'text-red-600'}">${r.tipo==='Ingreso'?'üìà':'üìâ'} Q${parseFloat(r.monto).toFixed(2)}</p>
                                                <p class="text-sm ${d?'text-gray-400':'text-gray-600'}">${new Date(r.fecha).toLocaleDateString('es-GT')}</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="editReg(${i})" class="text-blue-600 text-xl">‚úèÔ∏è</button>
                                                <button onclick="delReg(${i})" class="text-red-600 text-xl">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                        <p class="text-sm ${d?'text-gray-300':'text-gray-700'}"><strong>Categor√≠a:</strong> ${r.categoria}</p>
                                        <p class="text-sm ${d?'text-gray-400':'text-gray-600'}">${r.detalle}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'viajes') {
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">üöó Viajes</h1>
                        </div>
                        <div class="p-4">
                            <button onclick="abrirFormViaje()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-4 flex items-center justify-center gap-2">
                                <span class="text-xl">‚ûï</span> Nuevo Viaje
                            </button>
                            <div class="space-y-3">
                                ${App.viajes.map((v,i)=>`
                                    <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <p class="font-semibold ${d?'text-white':'text-gray-800'}">${v.origen} ‚Üí ${v.destino}</p>
                                                <p class="text-sm ${d?'text-gray-400':'text-gray-600'}">Cliente: ${v.cliente}</p>
                                            </div>
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                                v.estado==='Cotizado'?'bg-yellow-100 text-yellow-800':
                                                v.estado==='Programado'?'bg-blue-100 text-blue-800':
                                                'bg-green-100 text-green-800'
                                            }">${v.estado}</span>
                                        </div>
                                        <p class="text-lg font-bold text-emerald-600 mb-2">Q${parseFloat(v.costo).toFixed(2)}</p>
                                        ${v.estado!=='Realizado'?`<button onclick="realizarViaje(${i})" class="w-full bg-emerald-500 text-white py-2 rounded-lg font-semibold">‚úì Marcar como Realizado</button>`:''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
} else if (App.vista === 'diezmos') {
                const bal = calcBalance();
                const sug = bal.ganancia * 0.1;
                const q = getQuincena();
                const pag = App.diezmos.filter(dz=>{
                    const f = new Date(dz.fecha);
                    return f>=q.inicio && f<=q.fin;
                }).reduce((s,dz)=>s+parseFloat(dz.monto||0),0);
                const falt = Math.max(0, sug - pag);

                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold mb-4">üí∞ Diezmos</h1>
                            <div class="${d?'bg-gray-800':'bg-white/20'} backdrop-blur-sm rounded-xl p-4">
                                <p class="text-sm opacity-90 mb-2">Quincena: ${bal.quincena}</p>
                                <p class="text-2xl font-bold mb-2">Pago sugerido: Q${sug.toFixed(2)}</p>
                                <p class="text-sm">Pagado: Q${pag.toFixed(2)}</p>
                                <p class="text-sm">Faltante: Q${falt.toFixed(2)}</p>
                            </div>
                        </div>
                        <div class="p-4">
                            <button onclick="abrirFormDiezmo()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-4">‚ûï Registrar Pago</button>
                            <h3 class="font-bold mb-3 ${d?'text-white':'text-gray-800'}">Historial</h3>
                            <div class="space-y-3">
                                ${App.diezmos.sort((a,b)=>new Date(b.fecha)-new Date(a.fecha)).map((dz,i)=>`
                                    <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow">
                                        <div class="flex justify-between">
                                            <div>
                                                <p class="font-semibold text-emerald-600">Q${parseFloat(dz.monto).toFixed(2)}</p>
                                                <p class="text-sm ${d?'text-gray-400':'text-gray-600'}">${new Date(dz.fecha).toLocaleDateString('es-GT')} - ${dz.tipo}</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="editDiezmo(${i})" class="text-blue-600">‚úèÔ∏è</button>
                                                <button onclick="delDiezmo(${i})" class="text-red-600">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'resumen') {
                const bal = calcBalance();
                const sug = bal.ganancia * 0.1;
                const q = getQuincena();
                const pag = App.diezmos.filter(dz=>{
                    const f = new Date(dz.fecha);
                    return f>=q.inicio && f<=q.fin;
                }).reduce((s,dz)=>s+parseFloat(dz.monto||0),0);

                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">üìä Resumen Financiero</h1>
                            <p class="text-sm opacity-90 mt-2">Per√≠odo: ${bal.quincena}</p>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-6 shadow-lg">
                                <h3 class="font-bold text-lg mb-4 ${d?'text-white':'text-gray-800'}">üí∞ Balance General</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between"><span class="${d?'text-gray-300':'text-gray-600'}">Total Ingresos:</span><span class="font-bold text-emerald-600 text-xl">Q${bal.ingresos.toFixed(2)}</span></div>
                                    <div class="flex justify-between"><span class="${d?'text-gray-300':'text-gray-600'}">Total Gastos:</span><span class="font-bold text-red-600 text-xl">Q${bal.gastos.toFixed(2)}</span></div>
                                    <div class="border-t ${d?'border-gray-700':'border-gray-200'} pt-3 flex justify-between">
                                        <span class="font-semibold ${d?'text-white':'text-gray-800'}">Balance Neto:</span>
                                        <span class="font-bold text-2xl text-emerald-600">Q${bal.ganancia.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-6 shadow-lg">
                                <h3 class="font-bold text-lg mb-4 ${d?'text-white':'text-gray-800'}">üôè Diezmos</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between"><span class="${d?'text-gray-300':'text-gray-600'}">Sugerido (10%):</span><span class="font-bold text-blue-600">Q${sug.toFixed(2)}</span></div>
                                    <div class="flex justify-between"><span class="${d?'text-gray-300':'text-gray-600'}">Total Pagado:</span><span class="font-bold text-emerald-600">Q${pag.toFixed(2)}</span></div>
                                    <div class="flex justify-between"><span class="${d?'text-gray-300':'text-gray-600'}">Faltante:</span><span class="font-bold text-yellow-600">Q${Math.max(0,sug-pag).toFixed(2)}</span></div>
                                </div>
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'infoFinanciera') {
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">üè¶ Informaci√≥n Financiera</h1>
                        </div>
                        <div class="p-4">
                            <button onclick="abrirFormInfo()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-4">‚ûï Nueva Cuenta</button>
                            <div class="space-y-3">
                                ${App.infoFinanciera.map((info,i)=>`
                                    <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow">
                                        <div class="flex justify-between items-start mb-3">
                                            <div class="flex-1">
                                                <p class="font-bold ${d?'text-white':'text-gray-800'} text-lg">${info.banco||'Sin banco'}</p>
                                                <p class="text-sm ${d?'text-emerald-400':'text-emerald-600'} font-semibold">${info.nombreCuenta||''}</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="editInfo(${i})" class="text-blue-600">‚úèÔ∏è</button>
                                                <button onclick="delInfo(${i})" class="text-red-600">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-sm">
                                            ${info.numeroCuenta?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Cuenta:</strong> ${info.numeroCuenta}</p>`:''}
                                            ${info.tipoCuenta?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Tipo:</strong> ${info.tipoCuenta}</p>`:''}
                                            ${info.moneda?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Moneda:</strong> ${info.moneda}</p>`:''}
                                            ${info.numeroRegistrado?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Tel:</strong> ${info.numeroRegistrado}</p>`:''}
                                            ${info.nit?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>NIT:</strong> ${info.nit}</p>`:''}
                                            ${info.dpi?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>DPI:</strong> ${info.dpi}</p>`:''}
                                            ${info.tarjeta?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Tarjeta:</strong> ${info.tarjeta}</p>`:''}
                                            ${info.codigo?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>C√≥digo:</strong> ${info.codigo}</p>`:''}
                                            ${info.codigoApp?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>C√≥digo App:</strong> ${info.codigoApp}</p>`:''}
                                            ${info.clienteApp?`<p class="${d?'text-gray-400':'text-gray-600'}"><strong>Cliente App:</strong> ${info.clienteApp}</p>`:''}
                                        </div>
                                        ${info.notas?`<p class="text-xs ${d?'text-gray-500':'text-gray-500'} mt-3 p-2 ${d?'bg-gray-700':'bg-gray-50'} rounded"><strong>Notas:</strong> ${info.notas}</p>`:''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'notas') {
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">üìù Bloc de Notas</h1>
                        </div>
                        <div class="p-4">
                            <button onclick="abrirFormNota()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-4">‚ûï Nueva Nota</button>
                            <div class="space-y-3">
                                ${App.notas.sort((a,b)=>new Date(b.fecha||0)-new Date(a.fecha||0)).map((n,i)=>`
                                    <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <p class="font-semibold ${d?'text-white':'text-gray-800'} mb-2">${n.titulo}</p>
                                                <p class="text-sm ${d?'text-gray-400':'text-gray-600'}">${n.contenido}</p>
                                            </div>
                                            <div class="flex gap-2 ml-2">
                                                <button onclick="editNota(${i})" class="text-blue-600">‚úèÔ∏è</button>
                                                <button onclick="delNota(${i})" class="text-red-600">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ${navBar()}
                    </div>
                `;
            } else if (App.vista === 'ajustes') {
                a.innerHTML = `
                    <div class="min-h-screen ${d?'bg-gray-900':'bg-gray-50'} pb-20">
                        <div class="${d?'bg-gradient-to-r from-emerald-700 to-blue-700':'bg-gradient-to-r from-emerald-500 to-blue-600'} text-white p-6">
                            <h1 class="text-2xl font-bold">‚öôÔ∏è Ajustes</h1>
                        </div>
                        <div class="p-4">
                            <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow-lg mb-4">
                                <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">Logo</h3>
                                ${App.config.logo?`<div class="flex justify-center mb-4"><img src="${App.config.logo}" class="w-32 h-32 rounded-full object-cover"></div>`:''}
                                <label class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 cursor-pointer">
                                    üì∑ Subir Logo
                                    <input type="file" accept="image/*" onchange="subirLogo(event)" class="hidden">
                                </label>
                            </div>
                            <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow-lg mb-4">
                                <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">Informaci√≥n</h3>
                                <textarea id="cfgNombre" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}" rows="2">${App.config.nombre}</textarea>
                                <input type="text" id="cfgEslogan" value="${App.config.eslogan}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                                <input type="text" id="cfgDetalle" value="${App.config.detalle}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                            </div>
                            <div class="${d?'bg-gray-800':'bg-white'} rounded-xl p-4 shadow-lg mb-4">
                                <button onclick="toggleDark()" class="w-full bg-gradient-to-r from-gray-700 to-gray-900 text-white py-3 rounded-lg font-semibold">${d?'‚òÄÔ∏è Modo Claro':'üåô Modo Oscuro'}</button>
                            </div>
                            <button onclick="guardarConfig()" class="w-full bg-gradient-to-r from-emerald-500 to-blue-600 text-white py-4 rounded-xl font-semibold mb-3">üíæ Guardar</button>
                            <button onclick="if(confirm('¬øCerrar sesi√≥n?'))ir('login')" class="w-full bg-red-600 text-white py-4 rounded-xl font-semibold">üö™ Cerrar Sesi√≥n</button>
                        </div>
                        ${navBar()}
                    </div>
                `;
            }
            guardar();
        };

        const navBar = () => {
            const d = App.darkMode;
            const items = [['dashboard','üè†','Inicio'],['registros','üìñ','Registros'],['viajes','üöó','Viajes'],['diezmos','üí∞','Diezmos'],['resumen','üìä','Resumen']];
            return `
                <div class="fixed bottom-0 left-0 right-0 ${d?'bg-gray-800':'bg-white'} border-t ${d?'border-gray-700':'border-gray-200'} shadow-lg z-50">
                    <div class="flex justify-around items-center h-16">
                        ${items.map(([v,i,l])=>`
                            <button onclick="ir('${v}')" class="flex flex-col items-center justify-center flex-1 h-full ${App.vista===v?'text-emerald-600':d?'text-gray-400':'text-gray-600'}">
                                <div class="text-2xl">${i}</div>
                                <span class="text-xs mt-1">${l}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        };
const abrirFormReg = (idx=null) => {
            const d = App.darkMode;
            const edit = idx!==null;
            const r = edit ? App.registros[idx] : {fecha:new Date().toISOString().split('T')[0],monto:'',tipo:'Ingreso',categoria:'',detalle:''};
            crearModal(`
                <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">${edit?'Editar':'Nuevo'} Registro</h3>
                <input type="date" id="rFecha" value="${r.fecha}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="number" id="rMonto" placeholder="Monto (Q)" value="${r.monto}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <select id="rTipo" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <option ${r.tipo==='Ingreso'?'selected':''}>Ingreso</option>
                    <option ${r.tipo==='Gasto'?'selected':''}>Gasto</option>
                </select>
                <select id="rCat" onchange="if(this.value==='Otros')document.getElementById('rOtra').style.display='block';else document.getElementById('rOtra').style.display='none';" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <option value="">Categor√≠a</option>
                    ${App.categorias.map(c=>`<option value="${c}" ${r.categoria===c?'selected':''}>${c}</option>`).join('')}
                </select>
                <input type="text" id="rOtra" placeholder="Nueva categor√≠a" style="display:none;" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <textarea id="rDet" placeholder="Detalle" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}" rows="3">${r.detalle}</textarea>
                <div class="flex gap-2">
                    <button onclick="saveReg(${idx})" class="flex-1 bg-emerald-500 text-white py-3 rounded-lg font-semibold">${edit?'Actualizar':'Guardar'}</button>
                    <button onclick="cerrarModal()" class="flex-1 ${d?'bg-gray-700':'bg-gray-300'} py-3 rounded-lg font-semibold">Cancelar</button>
                </div>
            `);
        };

        const saveReg = (idx) => {
            let cat = document.getElementById('rCat').value;
            if(cat==='Otros'){
                const nueva = document.getElementById('rOtra').value;
                if(nueva && !App.categorias.includes(nueva)) App.categorias.push(nueva);
                cat = nueva || 'Otros';
            }
            const reg = {
                fecha: document.getElementById('rFecha').value,
                monto: document.getElementById('rMonto').value,
                tipo: document.getElementById('rTipo').value,
                categoria: cat,
                detalle: document.getElementById('rDet').value
            };
            if(idx!==null) App.registros[idx] = reg;
            else App.registros.push(reg);
            cerrarModal();
            render();
        };

        const editReg = (i) => abrirFormReg(i);
        const delReg = (i) => { if(confirm('¬øEliminar?')){ App.registros.splice(i,1); render(); }};

        const abrirFormViaje = () => {
            const d = App.darkMode;
            crearModal(`
                <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">Nuevo Viaje</h3>
                <input type="text" id="vOrigen" placeholder="Origen" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="text" id="vDestino" placeholder="Destino" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="text" id="vCliente" placeholder="Cliente" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="date" id="vFecha" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="number" id="vCosto" placeholder="Costo (Q)" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <div class="flex gap-2">
                    <button onclick="saveViaje()" class="flex-1 bg-emerald-500 text-white py-3 rounded-lg font-semibold">Guardar</button>
                    <button onclick="cerrarModal()" class="flex-1 ${d?'bg-gray-700':'bg-gray-300'} py-3 rounded-lg font-semibold">Cancelar</button>
                </div>
            `);
        };

        const saveViaje = () => {
            App.viajes.push({
                origen: document.getElementById('vOrigen').value,
                destino: document.getElementById('vDestino').value,
                cliente: document.getElementById('vCliente').value,
                fecha: document.getElementById('vFecha').value,
                costo: document.getElementById('vCosto').value,
                estado: 'Cotizado'
            });
            cerrarModal();
            render();
        };

        const realizarViaje = (i) => {
            const v = App.viajes[i];
            v.estado = 'Realizado';
            App.registros.push({
                fecha: v.fecha,
                monto: v.costo,
                tipo: 'Ingreso',
                categoria: 'Privado',
                detalle: `Viaje a ${v.destino}`
            });
            render();
        };

        const abrirFormDiezmo = (idx=null) => {
            const d = App.darkMode;
            const edit = idx!==null;
            const dz = edit ? App.diezmos[idx] : {monto:'',fecha:new Date().toISOString().split('T')[0],tipo:'Transferencia'};
            crearModal(`
                <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">${edit?'Editar':'Nuevo'} Pago</h3>
                <input type="number" id="dzMon" placeholder="Monto (Q)" value="${dz.monto}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <input type="date" id="dzFecha" value="${dz.fecha}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                <select id="dzTipo" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <option ${dz.tipo==='Transferencia'?'selected':''}>Transferencia</option>
                    <option ${dz.tipo==='Efectivo'?'selected':''}>Efectivo</option>
                </select>
                <div class="flex gap-2">
                    <button onclick="saveDiezmo(${idx})" class="flex-1 bg-emerald-500 text-white py-3 rounded-lg font-semibold">${edit?'Actualizar':'Guardar'}</button>
                    <button onclick="cerrarModal()" class="flex-1 ${d?'bg-gray-700':'bg-gray-300'} py-3 rounded-lg font-semibold">Cancelar</button>
                </div>
            `);
        };

        const saveDiezmo = (idx) => {
            const dz = {monto:document.getElementById('dzMon').value, fecha:document.getElementById('dzFecha').value, tipo:document.getElementById('dzTipo').value};
            if(idx!==null) App.diezmos[idx]=dz;
            else App.diezmos.push(dz);
            cerrarModal();
            render();
        };

        const editDiezmo = (i) => abrirFormDiezmo(i);
        const delDiezmo = (i) => { if(confirm('¬øEliminar?')){ App.diezmos.splice(i,1); render(); }};

        const abrirFormInfo = (idx=null) => {
            const d = App.darkMode;
            const edit = idx!==null;
            const info = edit ? App.infoFinanciera[idx] : {banco:'',nombreCuenta:'',numeroCuenta:'',tipoCuenta:'',moneda:'GTQ',numeroRegistrado:'',nit:'',dpi:'',tarjeta:'',codigo:'',fecha:'',codigoApp:'',clienteApp:'',contrase√±a:'',notas:''};
            crearModal(`
                <div class="max-h-[70vh] overflow-y-auto">
                    <h3 class="font-bold mb-4 ${d?'text-white':'text-gray-800'}">${edit?'Editar':'Nueva'} Cuenta</h3>
                    <input type="text" id="iBanco" placeholder="Banco" value="${info.banco}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iNomCta" placeholder="Nombre Cuenta" value="${info.nombreCuenta}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iNumCta" placeholder="N√∫mero Cuenta" value="${info.numeroCuenta}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iTipoCta" placeholder="Tipo Cuenta" value="${info.tipoCuenta}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <select id="iMoneda" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                        <option value="GTQ" ${info.moneda==='GTQ'?'selected':''}>GTQ</option>
                        <option value="USD" ${info.moneda==='USD'?'selected':''}>USD</option>
                    </select>
                    <input type="text" id="iNumReg" placeholder="Tel√©fono" value="${info.numeroRegistrado}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iNit" placeholder="NIT" value="${info.nit}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iDpi" placeholder="DPI" value="${info.dpi}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iTarjeta" placeholder="Tarjeta" value="${info.tarjeta}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iCodigo" placeholder="C√≥digo" value="${info.codigo}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="date" id="iFecha" value="${info.fecha}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg
-gray-700 text-white':''}">
                    <input type="text" id="iCodApp" placeholder="C√≥digo App" value="${info.codigoApp}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="text" id="iClieApp" placeholder="Cliente App" value="${info.clienteApp}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <input type="password" id="iPass" placeholder="Contrase√±a" value="${info.contrase√±a}" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}">
                    <textarea id="iNotas" placeholder="Notas" class="w-full p-3 border rounded-lg mb-3 ${d?'bg-gray-700 text-white':''}" rows="3">${info.notas}</textarea>
                    <div class="flex gap-2">
                        <button onclick="saveInfo(${idx})" class="flex-1 bg-emerald-500 text-white py-3 rounded-lg font-semibold">${edit?'Actualizar':'Guardar'}</button>
                        <button onclick="cerrarModal()" class="flex-1 ${d?'bg-gray-700':'bg-gray-300'} py-3 rounded-lg font-semibold">Cancelar</button>
                    </div>
                </div>
            `, true);
        };

        const saveInfo = (idx) => {
            const info = {
                banco:document.getElementById('iBanco').value,
                nombreCuenta:document.getElementById('iNomCta').value,
                numeroCuenta:document.getElementById('iNumCta').value,
                tipoCuenta:document.getElementById('iTipoCta').value,
                moneda:document.getElementById('iMoneda').value,
                numeroRegistrado:document.getElementById('iNumReg').value,
                nit:document.getElementById('iNit').value,
                dpi:document.getElementById('iDp
